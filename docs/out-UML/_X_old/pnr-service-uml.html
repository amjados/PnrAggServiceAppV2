
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PNR Aggregator - Service-Only UML Sequence Diagram</title>
<script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
mermaid.initialize({ startOnLoad: true });
</script>
<style>
body { font-family: Arial, sans-serif; background:#f7f7f7; padding:20px; }
.container { background:#fff; padding:20px; border-radius:12px; max-width:1000px; margin:auto;
             box-shadow:0 4px 20px rgba(0,0,0,0.1);}
h1 { margin-top:0; }
.mermaid { background:#fafafa; padding:15px; border-radius:8px; border:1px solid #ddd; }
</style>
</head>
<body>
<div class="container">
<h1>PNR Aggregator â€“ Service-Only Architecture UML Sequence Diagram</h1>
<p>This UML diagram reflects the architecture where all reactive logic lives inside Spring Services (NO Verticle).</p>

<div class="mermaid">
sequenceDiagram
    autonumber

    actor Client

    participant C as BookingController
    participant S as BookingAggregatorService
    participant TS as TripService
    participant BS as BaggageService
    participant TK as TicketService
    participant DB as MongoDB
    participant EB as EventBus

    Client->>C: GET /booking/{pnr}
    C->>S: aggregateBooking(pnr)

    par Fetch Trip & Baggage in Parallel
        S->>TS: getTripInfo(pnr)
        TS->>DB: find trip document
        DB-->>TS: trip result

        S->>BS: getBaggage(pnr)
        BS->>DB: find baggage document
        DB-->>BS: baggage result
    end

    loop For each passenger (parallel)
        S->>TK: getTicket(pnr, passengerNumber)
        TK->>DB: find ticket document
        DB-->>TK: ticket OR null
    end

    S->>S: merge trip + baggage + tickets
    S->>EB: publish("pnr.fetched")

    S-->>C: BookingResponse JSON
    C-->>Client: HTTP 200 + Response
</div>

</div>
</body>
</html>
